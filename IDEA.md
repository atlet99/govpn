# GoVPN: Эволюция OpenVPN на Go

## Видение проекта

GoVPN стремится стать **эволюцией OpenVPN**, сохраняя его проверенные временем концепции, но устраняя недостатки. Мы не изобретаем VPN заново, а модернизируем существующие каноны. Наш подход сфокусирован на:

1. **Совместимости с экосистемой OpenVPN** - сохранение основных концепций и совместимость с существующими клиентами
2. **Высокой производительности** - оптимизированный код на Go для улучшения скорости обработки соединений
3. **Современной безопасности** - встроенные механизмы OIDC, MFA и защита от современных угроз
4. **Гибкости развертывания** - от одиночных инсталляций до кластеров Kubernetes
5. **Простоте управления** - мощный CLI, REST API и интуитивная веб-панель при сохранении знакомой конфигурации

## Гибридный подход: Сохранение лучшего из OpenVPN

| Аспект | Что сохраняем из OpenVPN | Что улучшаем в GoVPN |
|--------|--------------------------|----------------------|
| Протокол | Базовый протокол OpenVPN для совместимости | Оптимизация обработки пакетов на Go |
| Конфигурация | Формат конфигурационных файлов | Дополнительные опции и упрощённое управление |
| Инфраструктура PKI | Принципы работы с сертификатами | Современные криптографические примитивы |
| Клиентская совместимость | Поддержка существующих клиентов OpenVPN | Новый оптимизированный клиент на Go |
| Модель безопасности | Базовая модель доверия | Расширенные возможности аутентификации |

## Преимущества GoVPN как эволюции OpenVPN

| Функция | OpenVPN | GoVPN |
|---------|---------|-------|
| Язык разработки | C | Go (с сохранением совместимости с OpenVPN) |
| Производительность | Ограниченная масштабируемость | Улучшенная производительность благодаря горутинам Go |
| Современная аутентификация | Ограниченная поддержка | Расширенная интеграция с OIDC, JWT и сохранение совместимости |
| MFA | Требует сторонних решений | Встроенная поддержка (OTP) с сохранением совместимости с базовой аутентификацией |
| LDAP интеграция | Сложная настройка | Упрощенная интеграция с сохранением привычной модели |
| Масштабирование | Ограниченное | Улучшенная поддержка кластеризации при совместимости с одиночными инсталляциями |
| API | Ограниченное | Полное REST API для автоматизации в дополнение к классическим методам управления |
| Мониторинг | Базовый | Расширенные метрики Prometheus при сохранении базовой модели логирования |
| БД | Файловая система | PostgreSQL с возможностью использовать классическое файловое хранение |

## Техническая архитектура

```
                   +----------------+
                   |                |
                   |  Web Dashboard |
                   |                |
                   +--------+-------+
                            |
                            v
+----------------+  +-------+-------+  +-----------------+
|                |  |               |  |                 |
| OpenVPN-       |  |               |  | Auth Providers  |
| совместимый    +->+  REST API     +<-+ (OIDC, LDAP,    |
| CLI клиент     |  |               |  |  классический)  |
+----------------+  +-------+-------+  +-----------------+
                            |
                            v
                   +--------+-------+
                   |                |
                   | Core Service   |
                   | (совместимый с |
                   |  OpenVPN)      |
                   +--------+-------+
                            |
              +-------------+------------+
              |                          |
    +---------+----------+    +----------+---------+
    |                    |    |                    |
    | PostgreSQL DB      |    | Файловое хранилище |
    | (для расширенных   |    | (для совместимости |
    |  возможностей)     |    |  с OpenVPN)        |
    +--------------------+    +--------------------+
```

## План MVP

### Фаза 1: Базовая функциональность и совместимость (1-2 месяца)

#### Ядро VPN
- [ ] Создание базовой архитектуры на Go с совместимостью с протоколом OpenVPN
- [ ] Реализация обработки OpenVPN-туннелей с возможностью дополнительно поддерживать WireGuard
- [ ] Базовая маршрутизация трафика по модели OpenVPN
- [ ] Тестирование совместимости с существующими клиентами OpenVPN

#### Конфигурация и управление
- [ ] Поддержка классических форматов конфигурации OpenVPN
- [ ] Разработка структуры REST API как дополнение к классическому управлению
- [ ] Прототип CLI для управления сервером, совместимый с OpenVPN
- [ ] Клиентское приложение на Go с поддержкой существующих конфигураций

#### Безопасность
- [ ] Совместимость с моделью сертификатов OpenVPN
- [ ] Шифрование соединений с поддержкой современных алгоритмов
- [ ] Управление сертификатами и ключами по модели OpenVPN

### Фаза 2: Расширенные функции при сохранении совместимости (2-3 месяца)

#### Тестирование кода
- [ ] Разработка стратегии тестирования (unit, integration, e2e)
- [ ] Написание юнит-тестов для ключевых компонентов:
  - [ ] Парсер конфигурации OpenVPN
  - [ ] Протокольный слой
  - [ ] Шифрование/дешифрование данных
  - [ ] TUN/TAP драйверы
- [ ] Интеграционные тесты совместимости с клиентами OpenVPN
- [ ] Тесты производительности и нагрузки
- [ ] Настройка CI/CD для автоматического запуска тестов
- [ ] Измерение и улучшение покрытия кода тестами

#### Аутентификация и авторизация
- [ ] Интеграция с OIDC провайдерами как дополнение к классической аутентификации
- [ ] Поддержка MFA (OTP) с сохранением базовой модели аутентификации
- [ ] Интеграция с LDAP с упрощенной настройкой
- [ ] Гибридная модель управления пользователями и группами

#### Хранение данных
- [ ] Гибридная система хранения (PostgreSQL + файловая система для совместимости)
- [ ] Миграции и конвертация данных из существующих инсталляций OpenVPN
- [ ] Оптимизация запросов и индексов при сохранении возможности работы без БД

#### Веб-интерфейс
- [ ] Прототип веб-панели управления с поддержкой классических конфигураций
- [ ] Мониторинг состояния системы с графическим отображением
- [ ] Управление пользователями и подключениями
- [ ] Интерактивная документация API (Swagger)

### Фаза 3: Масштабируемость и мониторинг (1-2 месяца)

#### Масштабирование
- [ ] Распределенный режим работы при сохранении совместимости с одиночными инсталляциями
- [ ] Развертывание в Kubernetes с поддержкой традиционных развертываний
- [ ] Балансировка нагрузки между нодами
- [ ] Инструкции миграции с OpenVPN на GoVPN

#### Мониторинг и логирование
- [ ] Экспорт метрик в Prometheus при сохранении классического логирования
- [ ] Структурированное логирование с обратной совместимостью
- [ ] Дашборды Grafana
- [ ] Алерты и уведомления

#### Тестирование и оптимизация
- [ ] Нагрузочное тестирование в сравнении с OpenVPN
- [ ] Тестирование совместимости со всеми популярными клиентами OpenVPN
- [ ] Оптимизация производительности
- [ ] Benchmarks по сравнению с OpenVPN

## Дорожная карта для будущих версий

### Версия 1.x
- Расширенная совместимость с экосистемой OpenVPN
- Инструменты миграции с OpenVPN на GoVPN
- Поддержка дополнительных аутентификаторов при сохранении базовой модели
- Автоматическое обновление конфигураций

### Версия 2.x
- Гибридная Zero Trust модель как дополнение к классической модели безопасности
- Опциональная Mesh VPN топология с обратной совместимостью
- SDK для расширений и плагинов, совместимый с плагинами OpenVPN
- Поддержка IPv6 с сохранением работы IPv4
- Опциональный анализ сетевого трафика

## Технический стек

- **Язык**: Go 1.22+
- **Совместимость**: OpenVPN 2.4+
- **БД**: PostgreSQL 15+ (опционально, с поддержкой файлового хранилища)
- **API**: REST + классическое управление через конфигурационные файлы
- **Веб**: React/Vue.js для административной панели
- **Контейнеризация**: Docker, Kubernetes с поддержкой обычных инсталляций
- **CI/CD**: GitHub Actions
- **Мониторинг**: Prometheus, Grafana + классическое логирование
- **Документация**: OpenAPI, Markdown, совместимая с OpenVPN документация
- **Тестирование**: Go testing, testify, goleak, tcpreplay, wireshark

## Начало разработки

Для начала работы над MVP рекомендуется следующая структура проекта:

```
govpn/
├── cmd/
│   ├── server/       # Серверная часть VPN с совместимостью OpenVPN
│   └── client/       # Клиентское приложение с поддержкой конфигураций OpenVPN
├── pkg/
│   ├── core/         # Ядро VPN с совместимостью протокола
│   ├── compat/       # Слой совместимости с OpenVPN
│   ├── api/          # REST API как дополнение к классическому управлению
│   ├── auth/         # Поддержка различных методов аутентификации
│   ├── storage/      # Гибридное хранилище данных
│   └── monitoring/   # Метрики и мониторинг
├── web/              # Веб-интерфейс
├── deploy/           # Конфигурации для различных типов развертывания
├── tests/            # Тесты (unit, integration, e2e, performance)
└── docs/             # Документация, включая миграцию с OpenVPN
```

## Заключение

GoVPN представляет собой эволюционный проект, направленный на модернизацию OpenVPN при сохранении обратной совместимости. Не отходя от проверенных временем канонов, но решая существующие проблемы с помощью современного стека технологий и архитектуры на Go, GoVPN предлагает гибридный подход, который позволит плавно перейти от OpenVPN к более производительному и функциональному решению без необходимости радикальных изменений в существующей инфраструктуре. 