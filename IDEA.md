# GoVPN: Эволюция OpenVPN на Go

## Текущий статус проекта

**Фаза 1**: ✅ **ЗАВЕРШЕНА** - Базовая функциональность и совместимость с OpenVPN  
**Фаза 2**: 🚧 **В ПРОЦЕССЕ** - Тестирование ✅ (завершено), Обфускация ✅ (базовая реализация), Аутентификация ⏳  

### Последние достижения:
- ✅ Реализована полная совместимость с протоколом OpenVPN
- ✅ Создано комплексное тестирование безопасности (AES-GCM, ChaCha20-Poly1305)
- ✅ Добавлены интеграционные тесты совместимости с OpenVPN конфигурациями
- ✅ Протестирована работа с TUN/TAP устройствами и обработкой сетевых пакетов
- ✅ Улучшен CLI с профилями, автозагрузкой и daemon-режимом
- ✅ Реализована базовая система обфускации трафика с XOR-шифрованием
- ✅ Добавлена модульная архитектура обфускации с автоматическим переключением методов
- ✅ Создан демонстрационный код для обфускации трафика

### В разработке:
- ✅ Завершение тестового покрытия (все основные тесты написаны)
- 🚧 Расширение системы обфускации (добавление новых методов)
- ⏳ Интеграция OIDC и расширенной аутентификации
- ⏳ Гибридная система хранения данных

## Видение проекта

GoVPN стремится стать **эволюцией OpenVPN**, сохраняя его проверенные временем концепции, но устраняя недостатки. Мы не изобретаем VPN заново, а модернизируем существующие каноны. Наш подход сфокусирован на:

1. **Совместимости с экосистемой OpenVPN** - сохранение основных концепций и совместимость с существующими клиентами
2. **Высокой производительности** - оптимизированный код на Go для улучшения скорости обработки соединений
3. **Современной безопасности** - встроенные механизмы OIDC, MFA и защита от современных угроз
4. **Гибкости развертывания** - от одиночных инсталляций до кластеров Kubernetes
5. **Простоте управления** - мощный CLI, REST API и интуитивная веб-панель при сохранении знакомой конфигурации

## Гибридный подход: Сохранение лучшего из OpenVPN

| Аспект | Что сохраняем из OpenVPN | Что улучшаем в GoVPN |
|--------|--------------------------|----------------------|
| Протокол | Базовый протокол OpenVPN для совместимости | Оптимизация обработки пакетов на Go |
| Конфигурация | Формат конфигурационных файлов | Дополнительные опции и упрощённое управление |
| Инфраструктура PKI | Принципы работы с сертификатами | Современные криптографические примитивы |
| Клиентская совместимость | Поддержка существующих клиентов OpenVPN | Новый оптимизированный клиент на Go |
| Модель безопасности | Базовая модель доверия | Расширенные возможности аутентификации |

## Преимущества GoVPN как эволюции OpenVPN

| Функция | OpenVPN | GoVPN |
|---------|---------|-------|
| Язык разработки | C | Go (с сохранением совместимости с OpenVPN) |
| Производительность | Ограниченная масштабируемость | Улучшенная производительность благодаря горутинам Go |
| Современная аутентификация | Ограниченная поддержка | Расширенная интеграция с OIDC, JWT и сохранение совместимости |
| MFA | Требует сторонних решений | Встроенная поддержка (OTP) с сохранением совместимости с базовой аутентификацией |
| LDAP интеграция | Сложная настройка | Упрощенная интеграция с сохранением привычной модели |
| Масштабирование | Ограниченное | Улучшенная поддержка кластеризации при совместимости с одиночными инсталляциями |
| API | Ограниченное | Полное REST API для автоматизации в дополнение к классическим методам управления |
| Мониторинг | Базовый | Расширенные метрики Prometheus при сохранении базовой модели логирования |
| БД | Файловая система | PostgreSQL с возможностью использовать классическое файловое хранение |
| Обход DPI/блокировок | Требует сторонних плагинов (obfsproxy) | Встроенная модульная система обфускации с адаптивным переключением методов |

## Техническая архитектура

```
                   +----------------+
                   |                |
                   |  Web Dashboard |
                   |                |
                   +--------+-------+
                            |
                            v
+----------------+  +-------+-------+  +-----------------+
|                |  |               |  |                 |
| OpenVPN-       |  |               |  | Auth Providers  |
| совместимый    +->+  REST API     +<-+ (OIDC, LDAP,    |
| CLI клиент     |  |               |  |  классический)  |
+----------------+  +-------+-------+  +-----------------+
                            |
                            v
                   +--------+-------+
                   |                |
                   | Core Service   |
                   | (совместимый с |
                   |  OpenVPN)      |
                   +--------+-------+
                            |
              +-------------+------------+
              |             |            |
    +---------+----------+  |  +----------+---------+
    |                    |  |  |                    |
    | PostgreSQL DB      |  |  | Файловое хранилище |
    | (для расширенных   |  |  | (для совместимости |
    |  возможностей)     |  |  |  с OpenVPN)        |
    +--------------------+  |  +--------------------+
                            |
                   +--------+-------+
                   |                |
                   | Obfuscation    |
                   | Engine         |
                   | ┌─────────────┐|
                   | │TLS Tunnel   ││
                   | │HTTP Mimicry ││
                   | │DNS Tunnel   ││
                   | │XOR/Scramble ││
                   | │Steganography││
                   | └─────────────┘|
                   +----------------+
```

## План MVP

### Фаза 1: Базовая функциональность и совместимость

#### Ядро VPN
- [x] Создание базовой архитектуры на Go с совместимостью с протоколом OpenVPN
- [x] Реализация обработки OpenVPN-туннелей с возможностью дополнительно поддерживать WireGuard
- [x] Базовая маршрутизация трафика по модели OpenVPN
- [x] Тестирование совместимости с существующими клиентами OpenVPN

#### Конфигурация и управление
- [x] Поддержка классических форматов конфигурации OpenVPN (pkg/compat/config_parser.go)
- [x] Разработка структуры REST API как дополнение к классическому управлению (pkg/api/)
- [x] Прототип CLI для управления сервером, совместимый с OpenVPN (cmd/server/main.go)
- [x] Клиентское приложение на Go с поддержкой существующих конфигураций (cmd/client/main.go)

#### Безопасность
- [x] Совместимость с моделью сертификатов OpenVPN (pkg/auth/certificates.go)
- [x] Шифрование соединений с поддержкой современных алгоритмов (AES-GCM, ChaCha20-Poly1305) (pkg/auth/cipher.go)
- [x] Управление сертификатами и ключами по модели OpenVPN (pkg/auth/certificates.go)
- [x] Протокольный слой совместимый с OpenVPN (pkg/auth/protocol.go)

#### Улучшения CLI и удобство использования
- [x] Стандартные пути для конфигураций (/etc/govpn, ~/.govpn) с автозагрузкой (pkg/core/homedir.go)
- [x] Поддержка групп конфигураций как в OpenVPN (конфиги из директории) (cmd/server/main.go)
- [x] Расширенное структурированное логирование с уровнями детализации (cmd/server/main.go)
- [x] Автозапуск в режиме демона с интеграцией в системные службы (systemd, launchd) (cmd/server/main.go)
- [x] Горячая перезагрузка конфигурации без разрыва соединений клиентов (cmd/server/main.go)
- [x] Упрощенные команды для управления состоянием и статистикой соединений (cmd/server/main.go)
- [x] Возможность запуска нескольких экземпляров с разной конфигурацией (cmd/server/main.go)
- [x] Автоматическое определение и настройка сетевых интерфейсов (pkg/core/tuntap.go)
- [x] Встроенный мониторинг производительности и состояния подключений через CLI (cmd/server/main.go)
- [x] Возможность быстрого переключения между профилями в клиентском приложении (pkg/core/homedir.go)

### Фаза 2: Расширенные функции при сохранении совместимости

#### Тестирование кода
- [x] Разработка стратегии тестирования (unit, integration, e2e)
- [x] Написание юнит-тестов для ключевых компонентов:
  - [x] Парсер конфигурации OpenVPN (pkg/core/config_test.go)
  - [x] Протокольный слой (pkg/auth/protocol.go)
  - [x] Шифрование/дешифрование данных (pkg/auth/cipher_test.go)
  - [x] TUN/TAP драйверы (pkg/core/tuntap_test.go)
- [x] Интеграционные тесты совместимости с клиентами OpenVPN (pkg/core/integration_test.go)
- [x] Тесты совместимости с OpenVPN конфигурациями и протоколом
- [x] Тесты безопасности криптографических функций (AES-GCM, ChaCha20-Poly1305)
- [x] Тесты валидации сетевых пакетов (IPv4/IPv6)
- [x] Тесты производительности шифрования/дешифрования
- [x] Тесты производительности и нагрузки системы (pkg/core/performance_test.go)
- [x] Тесты работы с домашними директориями и конфигурациями (pkg/core/homedir_test.go)
- [x] Тесты VPN функциональности (pkg/core/vpn_test.go)
- [x] Тесты системы сертификатов (pkg/auth/certificates_test.go)
- [x] Тесты модуля обфускации (pkg/obfuscation/obfuscation_test.go)
- [ ] Настройка CI/CD для автоматического запуска тестов (ЗАМОРОЖЕНО)
- [ ] Измерение и улучшение покрытия кода тестами (ЗАМОРОЖЕНО)

#### Обфускация трафика и обход DPI
- [x] **Модульная система обфускации** с возможностью комбинирования методов ✅
  - [x] **Базовая архитектура обфускации** - движок обфускации с поддержкой различных методов ✅
  - [x] **Интерфейс Obfuscator** - унифицированный интерфейс для всех методов обфускации ✅
  - [x] **Система метрик** - сбор статистики по каждому методу обфускации ✅
  - [ ] **Traffic Mimicry** - маскировка VPN трафика под HTTPS/HTTP/SSH
  - [x] **TLS Tunneling** - инкапсуляция VPN трафика в легитимные TLS соединения ✅
  - [x] **XOR Obfuscation** - дополнительное XOR шифрование поверх основного ✅
- [ ] **Анти-статистический анализ**
  - [x] **Packet Size Randomization** - рандомизация размеров пакетов ✅
  - [ ] **Timing Obfuscation** - изменение временных интервалов между пакетами  
  - [ ] **Traffic Padding** - добавление фиктивного трафика для маскировки паттернов
  - [ ] **Flow Watermarking** - искажение статистических характеристик потока
- [ ] **Steganography методы**
  - [ ] **HTTP Cover Traffic** - сокрытие VPN данных в HTTP запросах/ответах
  - [ ] **DNS Tunneling** - передача данных через DNS запросы (резервный канал)
  - [ ] **Image/Video Steganography** - встраивание данных в медиа-контент
- [x] **Конфигурация и управление** ✅
  - [x] **DPI Detector** - обнаружение блокировок DPI и проблем с соединением ✅
  - [x] Автоматический выбор оптимального метода обфускации по условиям сети ✅
  - [x] Динамическое переключение методов при обнаружении блокировки ✅
  - [x] Конфигурируемые профили обфускации (China, Iran, Russia, etc.) ✅
  - [x] **Stub Obfuscators** - заглушки для методов в разработке ✅
  - [x] **Обёртка соединений** - возможность оборачивать net.Conn для прозрачной обфускации ✅
  - [x] **Демонстрационные примеры** - examples/obfuscation_demo.go с примерами использования ✅
  - [ ] Совместимость с OpenVPN obfsproxy плагинами

#### Аутентификация и авторизация  
- [ ] Интеграция с OIDC провайдерами как дополнение к классической аутентификации
- [ ] Поддержка MFA (OTP) с сохранением базовой модели аутентификации
- [ ] Интеграция с LDAP с упрощенной настройкой
- [ ] Гибридная модель управления пользователями и группами

#### Хранение данных
- [ ] Гибридная система хранения (PostgreSQL + файловая система для совместимости)
- [ ] Миграции и конвертация данных из существующих инсталляций OpenVPN
- [ ] Оптимизация запросов и индексов при сохранении возможности работы без БД

#### Веб-интерфейс
- [ ] Прототип веб-панели управления с поддержкой классических конфигураций
- [ ] Мониторинг состояния системы с графическим отображением
- [ ] Управление пользователями и подключениями
- [ ] Интерактивная документация API (Swagger)

### Фаза 3: Масштабируемость и мониторинг

#### Масштабирование
- [ ] Распределенный режим работы при сохранении совместимости с одиночными инсталляциями
- [ ] Развертывание в Kubernetes с поддержкой традиционных развертываний
- [ ] Балансировка нагрузки между нодами
- [ ] Инструкции миграции с OpenVPN на GoVPN

#### Мониторинг и логирование
- [ ] Экспорт метрик в Prometheus при сохранении классического логирования
- [ ] Структурированное логирование с обратной совместимостью
- [ ] Дашборды Grafana
- [ ] Алерты и уведомления

#### Тестирование и оптимизация
- [ ] Нагрузочное тестирование в сравнении с OpenVPN
- [ ] Тестирование совместимости со всеми популярными клиентами OpenVPN
- [ ] Оптимизация производительности
- [ ] Benchmarks по сравнению с OpenVPN

## Дорожная карта для будущих версий

### Версия 1.x
- Расширенная совместимость с экосистемой OpenVPN
- Инструменты миграции с OpenVPN на GoVPN
- Поддержка дополнительных аутентификаторов при сохранении базовой модели
- Автоматическое обновление конфигураций

### Версия 2.x
- Гибридная Zero Trust модель как дополнение к классической модели безопасности
- Опциональная Mesh VPN топология с обратной совместимостью
- SDK для расширений и плагинов, совместимый с плагинами OpenVPN
- Поддержка IPv6 с сохранением работы IPv4
- Опциональный анализ сетевого трафика

## Технический стек

- **Язык**: Go 1.22+
- **Совместимость**: OpenVPN 2.4+
- **БД**: PostgreSQL 15+ (опционально, с поддержкой файлового хранилища)
- **API**: REST + классическое управление через конфигурационные файлы
- **Веб**: React/Vue.js для административной панели
- **Контейнеризация**: Docker, Kubernetes с поддержкой обычных инсталляций
- **CI/CD**: GitHub Actions
- **Мониторинг**: Prometheus, Grafana + классическое логирование
- **Документация**: OpenAPI, Markdown, совместимая с OpenVPN документация
- **Тестирование**: Go testing, testify, goleak, tcpreplay, wireshark
- **Обфускация**: Встроенные модули (TLS tunnel, HTTP mimicry, DNS tunnel), совместимость с obfsproxy

## Начало разработки

✅ **РЕАЛИЗОВАНО** - Структура проекта создана и основные компоненты реализованы:

Для начала работы над MVP рекомендуется следующая структура проекта:

```
govpn/
├── cmd/
│   ├── server/       # ✅ Серверная часть VPN с совместимостью OpenVPN
│   ├── client/       # ✅ Клиентское приложение с поддержкой конфигураций OpenVPN
│   └── generate_certs/ # ✅ Генератор сертификатов для PKI
├── pkg/
│   ├── core/         # ✅ Ядро VPN с совместимостью протокола
│   │   ├── config.go
│   │   ├── vpn.go
│   │   ├── homedir.go
│   │   ├── tuntap_test.go     # ✅ Тесты TUN/TAP устройств
│   │   └── integration_test.go # ✅ Интеграционные тесты совместимости
│   ├── compat/       # ✅ Слой совместимости с OpenVPN
│   ├── api/          # ✅ REST API как дополнение к классическому управлению
│   ├── auth/         # ✅ Поддержка различных методов аутентификации
│   │   ├── cipher.go
│   │   └── cipher_test.go     # ✅ Тесты криптографических функций
│   ├── obfuscation/  # ✅ Модуль обфускации трафика и обхода DPI
│   │   ├── obfuscation.go     # ✅ Главный движок обфускации
│   │   ├── obfuscation_test.go # ✅ Тесты обфускации
│   │   ├── protocols/         # Протокольные обфускаторы (заглушки)
│   │   │   ├── tls_tunnel.go     # TLS туннелирование (заглушка)
│   │   │   ├── http_mimicry.go   # HTTP маскировка (заглушка)
│   │   │   ├── ssh_mimicry.go    # SSH маскировка (заглушка)
│   │   │   └── dns_tunnel.go     # DNS туннелирование (заглушка)
│   │   ├── statistical/       # Анти-статистические методы
│   │   │   ├── packet_padding.go # Рандомизация размеров пакетов
│   │   │   ├── timing_obfs.go    # Временная обфускация
│   │   │   └── flow_shaping.go   # Изменение характеристик потока
│   │   ├── steganography/     # Стеганографические методы
│   │   │   ├── http_stego.go     # HTTP стеганография
│   │   │   ├── media_stego.go    # Медиа стеганография
│   │   │   └── dns_stego.go      # DNS стеганография
│   │   ├── crypto/            # Дополнительные криптографические обфускаторы
│   │   │   ├── xor_cipher.go     # ✅ XOR обфускация (встроена в obfuscation.go)
│   │   │   └── scrambler.go      # Скремблирование данных
│   │   ├── profiles/          # ✅ Профили обфускации для разных регионов (встроены)
│   │   │   ├── china.go          # ✅ Специфичная конфигурация для Китая
│   │   │   ├── iran.go           # ✅ Для Ирана
│   │   │   └── russia.go         # ✅ Для России
│   │   └── detection/         # ✅ Система обнаружения и адаптации (встроена)
│   │       ├── dpi_detector.go   # ✅ Обнаружение DPI блокировок
│   │       └── adaptive_switch.go # ✅ Автоматическое переключение методов
│   ├── storage/      # Гибридное хранилище данных (пустая директория)
│   └── monitoring/   # Метрики и мониторинг (пустая директория)
├── web/              # Веб-интерфейс (пустая директория)
├── deploy/           # ✅ Конфигурации для различных типов развертывания
├── examples/         # ✅ Примеры использования
│   └── obfuscation_demo.go # ✅ Демонстрация обфускации
├── docs/             # ✅ Документация, включая миграцию с OpenVPN
│   └── obfuscation/  # ✅ Документация по обфускации
│       └── README.md # ✅ Описание методов обфускации
├── Makefile          # ✅ Система сборки с кросс-платформенной поддержкой
├── go.mod            # ✅ Управление зависимостями Go
├── go.sum            # ✅ Контрольные суммы зависимостей
└── README.md         # ✅ Основная документация проекта
```

## Заключение

GoVPN представляет собой эволюционный проект, направленный на модернизацию OpenVPN при сохранении обратной совместимости. Не отходя от проверенных временем канонов, но решая существующие проблемы с помощью современного стека технологий и архитектуры на Go, GoVPN предлагает гибридный подход, который позволит плавно перейти от OpenVPN к более производительному и функциональному решению без необходимости радикальных изменений в существующей инфраструктуре. 