# GoVPN: Эволюция OpenVPN на Go

## Текущий статус проекта

**Фаза 1**: ✅ **ЗАВЕРШЕНА** - Базовая функциональность и совместимость с OpenVPN  
**Фаза 2**: 🚧 **В ПРОЦЕССЕ** - Тестирование ✅ (70% завершено), Аутентификация ⏳  

### Последние достижения:
- ✅ Реализована полная совместимость с протоколом OpenVPN
- ✅ Создано комплексное тестирование безопасности (AES-GCM, ChaCha20-Poly1305)
- ✅ Добавлены интеграционные тесты совместимости с OpenVPN конфигурациями
- ✅ Протестирована работа с TUN/TAP устройствами и обработкой сетевых пакетов
- ✅ Улучшен CLI с профилями, автозагрузкой и daemon-режимом

### В разработке:
- 🚧 Завершение тестового покрытия (CI/CD, нагрузочные тесты)
- 🆕 Модульная система обфускации трафика и обхода DPI
- ⏳ Интеграция OIDC и расширенной аутентификации
- ⏳ Гибридная система хранения данных

## Видение проекта

GoVPN стремится стать **эволюцией OpenVPN**, сохраняя его проверенные временем концепции, но устраняя недостатки. Мы не изобретаем VPN заново, а модернизируем существующие каноны. Наш подход сфокусирован на:

1. **Совместимости с экосистемой OpenVPN** - сохранение основных концепций и совместимость с существующими клиентами
2. **Высокой производительности** - оптимизированный код на Go для улучшения скорости обработки соединений
3. **Современной безопасности** - встроенные механизмы OIDC, MFA и защита от современных угроз
4. **Гибкости развертывания** - от одиночных инсталляций до кластеров Kubernetes
5. **Простоте управления** - мощный CLI, REST API и интуитивная веб-панель при сохранении знакомой конфигурации

## Гибридный подход: Сохранение лучшего из OpenVPN

| Аспект | Что сохраняем из OpenVPN | Что улучшаем в GoVPN |
|--------|--------------------------|----------------------|
| Протокол | Базовый протокол OpenVPN для совместимости | Оптимизация обработки пакетов на Go |
| Конфигурация | Формат конфигурационных файлов | Дополнительные опции и упрощённое управление |
| Инфраструктура PKI | Принципы работы с сертификатами | Современные криптографические примитивы |
| Клиентская совместимость | Поддержка существующих клиентов OpenVPN | Новый оптимизированный клиент на Go |
| Модель безопасности | Базовая модель доверия | Расширенные возможности аутентификации |

## Преимущества GoVPN как эволюции OpenVPN

| Функция | OpenVPN | GoVPN |
|---------|---------|-------|
| Язык разработки | C | Go (с сохранением совместимости с OpenVPN) |
| Производительность | Ограниченная масштабируемость | Улучшенная производительность благодаря горутинам Go |
| Современная аутентификация | Ограниченная поддержка | Расширенная интеграция с OIDC, JWT и сохранение совместимости |
| MFA | Требует сторонних решений | Встроенная поддержка (OTP) с сохранением совместимости с базовой аутентификацией |
| LDAP интеграция | Сложная настройка | Упрощенная интеграция с сохранением привычной модели |
| Масштабирование | Ограниченное | Улучшенная поддержка кластеризации при совместимости с одиночными инсталляциями |
| API | Ограниченное | Полное REST API для автоматизации в дополнение к классическим методам управления |
| Мониторинг | Базовый | Расширенные метрики Prometheus при сохранении базовой модели логирования |
| БД | Файловая система | PostgreSQL с возможностью использовать классическое файловое хранение |
| Обход DPI/блокировок | Требует сторонних плагинов (obfsproxy) | Встроенная модульная система обфускации с адаптивным переключением методов |

## Техническая архитектура

```
                   +----------------+
                   |                |
                   |  Web Dashboard |
                   |                |
                   +--------+-------+
                            |
                            v
+----------------+  +-------+-------+  +-----------------+
|                |  |               |  |                 |
| OpenVPN-       |  |               |  | Auth Providers  |
| совместимый    +->+  REST API     +<-+ (OIDC, LDAP,    |
| CLI клиент     |  |               |  |  классический)  |
+----------------+  +-------+-------+  +-----------------+
                            |
                            v
                   +--------+-------+
                   |                |
                   | Core Service   |
                   | (совместимый с |
                   |  OpenVPN)      |
                   +--------+-------+
                            |
              +-------------+------------+
              |             |            |
    +---------+----------+  |  +----------+---------+
    |                    |  |  |                    |
    | PostgreSQL DB      |  |  | Файловое хранилище |
    | (для расширенных   |  |  | (для совместимости |
    |  возможностей)     |  |  |  с OpenVPN)        |
    +--------------------+  |  +--------------------+
                            |
                   +--------+-------+
                   |                |
                   | Obfuscation    |
                   | Engine         |
                   | ┌─────────────┐|
                   | │TLS Tunnel   ││
                   | │HTTP Mimicry ││
                   | │DNS Tunnel   ││
                   | │XOR/Scramble ││
                   | │Steganography││
                   | └─────────────┘|
                   +----------------+
```

## План MVP

### Фаза 1: Базовая функциональность и совместимость

#### Ядро VPN
- [x] Создание базовой архитектуры на Go с совместимостью с протоколом OpenVPN
- [x] Реализация обработки OpenVPN-туннелей с возможностью дополнительно поддерживать WireGuard
- [x] Базовая маршрутизация трафика по модели OpenVPN
- [x] Тестирование совместимости с существующими клиентами OpenVPN

#### Конфигурация и управление
- [x] Поддержка классических форматов конфигурации OpenVPN
- [x] Разработка структуры REST API как дополнение к классическому управлению
- [x] Прототип CLI для управления сервером, совместимый с OpenVPN
- [x] Клиентское приложение на Go с поддержкой существующих конфигураций

#### Безопасность
- [x] Совместимость с моделью сертификатов OpenVPN
- [x] Шифрование соединений с поддержкой современных алгоритмов (AES-GCM, ChaCha20-Poly1305)
- [x] Управление сертификатами и ключами по модели OpenVPN

#### Улучшения CLI и удобство использования
- [x] Стандартные пути для конфигураций (/etc/govpn, ~/.govpn) с автозагрузкой
- [x] Поддержка групп конфигураций как в OpenVPN (конфиги из директории)
- [x] Расширенное структурированное логирование с уровнями детализации
- [x] Автозапуск в режиме демона с интеграцией в системные службы (systemd, launchd)
- [x] Горячая перезагрузка конфигурации без разрыва соединений клиентов
- [x] Упрощенные команды для управления состоянием и статистикой соединений
- [x] Возможность запуска нескольких экземпляров с разной конфигурацией
- [x] Автоматическое определение и настройка сетевых интерфейсов
- [x] Встроенный мониторинг производительности и состояния подключений через CLI
- [x] Возможность быстрого переключения между профилями в клиентском приложении

### Фаза 2: Расширенные функции при сохранении совместимости

#### Тестирование кода
- [x] Разработка стратегии тестирования (unit, integration, e2e)
- [x] Написание юнит-тестов для ключевых компонентов:
  - [x] Парсер конфигурации OpenVPN
  - [x] Протокольный слой
  - [x] Шифрование/дешифрование данных (pkg/auth/cipher_test.go)
  - [x] TUN/TAP драйверы (pkg/core/tuntap_test.go)
- [x] Интеграционные тесты совместимости с клиентами OpenVPN (pkg/core/integration_test.go)
- [x] Тесты совместимости с OpenVPN конфигурациями и протоколом
- [x] Тесты безопасности криптографических функций (AES-GCM, ChaCha20-Poly1305)
- [x] Тесты валидации сетевых пакетов (IPv4/IPv6)
- [x] Тесты производительности шифрования/дешифрования
- [ ] Тесты производительности и нагрузки системы
- [ ] Настройка CI/CD для автоматического запуска тестов
- [ ] Измерение и улучшение покрытия кода тестами

#### Обфускация трафика и обход DPI
- [ ] **Модульная система обфускации** с возможностью комбинирования методов
  - [ ] **Traffic Mimicry** - маскировка VPN трафика под HTTPS/HTTP/SSH
  - [ ] **TLS Tunneling** - инкапсуляция VPN трафика в легитимные TLS соединения
  - [ ] **Domain Fronting** - использование CDN для сокрытия реального назначения
  - [ ] **XOR Obfuscation** - дополнительное XOR шифрование поверх основного
- [ ] **Анти-статистический анализ**
  - [ ] **Packet Size Randomization** - рандомизация размеров пакетов
  - [ ] **Timing Obfuscation** - изменение временных интервалов между пакетами  
  - [ ] **Traffic Padding** - добавление фиктивного трафика для маскировки паттернов
  - [ ] **Flow Watermarking** - искажение статистических характеристик потока
- [ ] **Steganography методы**
  - [ ] **HTTP Cover Traffic** - сокрытие VPN данных в HTTP запросах/ответах
  - [ ] **DNS Tunneling** - передача данных через DNS запросы (резервный канал)
  - [ ] **Image/Video Steganography** - встраивание данных в медиа-контент
- [ ] **Конфигурация и управление**
  - [ ] Автоматический выбор оптимального метода обфускации по условиям сети
  - [ ] Динамическое переключение методов при обнаружении блокировки
  - [ ] Конфигурируемые профили обфускации (China, Iran, Russia, etc.)
  - [ ] Совместимость с OpenVPN obfsproxy плагинами

#### Аутентификация и авторизация  
- [ ] Интеграция с OIDC провайдерами как дополнение к классической аутентификации
- [ ] Поддержка MFA (OTP) с сохранением базовой модели аутентификации
- [ ] Интеграция с LDAP с упрощенной настройкой
- [ ] Гибридная модель управления пользователями и группами

#### Хранение данных
- [ ] Гибридная система хранения (PostgreSQL + файловая система для совместимости)
- [ ] Миграции и конвертация данных из существующих инсталляций OpenVPN
- [ ] Оптимизация запросов и индексов при сохранении возможности работы без БД

#### Веб-интерфейс
- [ ] Прототип веб-панели управления с поддержкой классических конфигураций
- [ ] Мониторинг состояния системы с графическим отображением
- [ ] Управление пользователями и подключениями
- [ ] Интерактивная документация API (Swagger)

### Фаза 3: Масштабируемость и мониторинг

#### Масштабирование
- [ ] Распределенный режим работы при сохранении совместимости с одиночными инсталляциями
- [ ] Развертывание в Kubernetes с поддержкой традиционных развертываний
- [ ] Балансировка нагрузки между нодами
- [ ] Инструкции миграции с OpenVPN на GoVPN

#### Мониторинг и логирование
- [ ] Экспорт метрик в Prometheus при сохранении классического логирования
- [ ] Структурированное логирование с обратной совместимостью
- [ ] Дашборды Grafana
- [ ] Алерты и уведомления

#### Тестирование и оптимизация
- [ ] Нагрузочное тестирование в сравнении с OpenVPN
- [ ] Тестирование совместимости со всеми популярными клиентами OpenVPN
- [ ] Оптимизация производительности
- [ ] Benchmarks по сравнению с OpenVPN

## Дорожная карта для будущих версий

### Версия 1.x
- Расширенная совместимость с экосистемой OpenVPN
- Инструменты миграции с OpenVPN на GoVPN
- Поддержка дополнительных аутентификаторов при сохранении базовой модели
- Автоматическое обновление конфигураций

### Версия 2.x
- Гибридная Zero Trust модель как дополнение к классической модели безопасности
- Опциональная Mesh VPN топология с обратной совместимостью
- SDK для расширений и плагинов, совместимый с плагинами OpenVPN
- Поддержка IPv6 с сохранением работы IPv4
- Опциональный анализ сетевого трафика

## Технический стек

- **Язык**: Go 1.22+
- **Совместимость**: OpenVPN 2.4+
- **БД**: PostgreSQL 15+ (опционально, с поддержкой файлового хранилища)
- **API**: REST + классическое управление через конфигурационные файлы
- **Веб**: React/Vue.js для административной панели
- **Контейнеризация**: Docker, Kubernetes с поддержкой обычных инсталляций
- **CI/CD**: GitHub Actions
- **Мониторинг**: Prometheus, Grafana + классическое логирование
- **Документация**: OpenAPI, Markdown, совместимая с OpenVPN документация
- **Тестирование**: Go testing, testify, goleak, tcpreplay, wireshark
- **Обфускация**: Встроенные модули (TLS tunnel, HTTP mimicry, DNS tunnel), совместимость с obfsproxy

## Начало разработки

Для начала работы над MVP рекомендуется следующая структура проекта:

```
govpn/
├── cmd/
│   ├── server/       # Серверная часть VPN с совместимостью OpenVPN
│   └── client/       # Клиентское приложение с поддержкой конфигураций OpenVPN
├── pkg/
│   ├── core/         # Ядро VPN с совместимостью протокола
│   │   ├── config.go
│   │   ├── vpn.go
│   │   ├── homedir.go
│   │   ├── tuntap_test.go     # ✅ Тесты TUN/TAP устройств
│   │   └── integration_test.go # ✅ Интеграционные тесты совместимости
│   ├── compat/       # Слой совместимости с OpenVPN
│   ├── api/          # REST API как дополнение к классическому управлению
│   ├── auth/         # Поддержка различных методов аутентификации
│   │   ├── cipher.go
│   │   └── cipher_test.go     # ✅ Тесты криптографических функций
│   ├── obfuscation/  # 🚧 Модуль обфускации трафика и обхода DPI
│   │   ├── engine.go          # Главный движок обфускации
│   │   ├── protocols/         # Протокольные обфускаторы
│   │   │   ├── tls_tunnel.go     # TLS туннелирование
│   │   │   ├── http_mimicry.go   # HTTP маскировка
│   │   │   ├── ssh_mimicry.go    # SSH маскировка
│   │   │   └── dns_tunnel.go     # DNS туннелирование
│   │   ├── statistical/       # Анти-статистические методы
│   │   │   ├── packet_padding.go # Рандомизация размеров пакетов
│   │   │   ├── timing_obfs.go    # Временная обфускация
│   │   │   └── flow_shaping.go   # Изменение характеристик потока
│   │   ├── steganography/     # Стеганографические методы
│   │   │   ├── http_stego.go     # HTTP стеганография
│   │   │   ├── media_stego.go    # Медиа стеганография
│   │   │   └── dns_stego.go      # DNS стеганография
│   │   ├── crypto/            # Дополнительные криптографические обфускаторы
│   │   │   ├── xor_cipher.go     # XOR обфускация
│   │   │   └── scrambler.go      # Скремблирование данных
│   │   ├── profiles/          # Профили обфускации для разных регионов
│   │   │   ├── china.go          # Специфичная конфигурация для Китая
│   │   │   ├── iran.go           # Для Ирана
│   │   │   └── russia.go         # Для России
│   │   └── detection/         # Система обнаружения и адаптации
│   │       ├── dpi_detector.go   # Обнаружение DPI блокировок
│   │       └── adaptive_switch.go # Автоматическое переключение методов
│   ├── storage/      # Гибридное хранилище данных
│   └── monitoring/   # Метрики и мониторинг
├── web/              # Веб-интерфейс
├── deploy/           # Конфигурации для различных типов развертывания
├── tests/            # Тесты (unit, integration, e2e, performance)
│   └── obfuscation/  # Специализированные тесты обфускации
│       ├── dpi_bypass_test.go    # Тесты обхода DPI
│       └── stealth_test.go       # Тесты скрытности
└── docs/             # Документация, включая миграцию с OpenVPN
    └── obfuscation/  # Документация по обфускации
        ├── methods.md            # Описание методов
        ├── configuration.md      # Конфигурация
        └── regional_guides.md    # Региональные руководства
```

## Заключение

GoVPN представляет собой эволюционный проект, направленный на модернизацию OpenVPN при сохранении обратной совместимости. Не отходя от проверенных временем канонов, но решая существующие проблемы с помощью современного стека технологий и архитектуры на Go, GoVPN предлагает гибридный подход, который позволит плавно перейти от OpenVPN к более производительному и функциональному решению без необходимости радикальных изменений в существующей инфраструктуре. 